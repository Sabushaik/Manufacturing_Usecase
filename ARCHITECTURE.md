# Architecture Diagram

## Prompt Caching Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              APPLICATION STARTUP                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Step 1: Load Sample Images                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ samples/hardhat/hardhat1.jpg                                  â”‚          â”‚
â”‚  â”‚ samples/goggles/goggles1.jpg                                  â”‚          â”‚
â”‚  â”‚ samples/vest/safety_vest1.jpg                                 â”‚          â”‚
â”‚  â”‚ samples/gloves/gloves1.jpg                                    â”‚          â”‚
â”‚  â”‚ samples/shoes/shoes1.jpg                                      â”‚          â”‚
â”‚  â”‚ samples/forklift/forklift1.jpg                                â”‚          â”‚
â”‚  â”‚ samples/truck/truck1.jpg                                      â”‚          â”‚
â”‚  â”‚ samples/excavator/excavator1.jpg                              â”‚          â”‚
â”‚  â”‚ samples/bull_dozer/bull_dozer1.jpg                            â”‚          â”‚
â”‚  â”‚ samples/cement_mixer/cement_mixer1.jpg                        â”‚          â”‚
â”‚  â”‚ samples/roller/roller1.jpg                                    â”‚          â”‚
â”‚  â”‚ samples/tracktor/tracktor1.jpg                                â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â–¼                                                  â”‚
â”‚  Step 2: Encode as Base64                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ encode_image(path) â†’ base64_string                            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â–¼                                                  â”‚
â”‚  Step 3: Build System Messages                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Content Block 1:  {"type": "text", "text": SYSTEM_TEXT}      â”‚          â”‚
â”‚  â”‚ Content Block 2:  {"type": "text", "text": "Example: hardhat"}â”‚         â”‚
â”‚  â”‚ Content Block 3:  {"type": "image", "source": {base64}}      â”‚          â”‚
â”‚  â”‚ Content Block 4:  {"type": "text", "text": "Example: goggles"}â”‚         â”‚
â”‚  â”‚ Content Block 5:  {"type": "image", "source": {base64}}      â”‚          â”‚
â”‚  â”‚ ...                                                            â”‚          â”‚
â”‚  â”‚ Content Block 25: {"type": "image", "source": {base64},       â”‚          â”‚
â”‚  â”‚                    "cachePoint": "ephemeral"} â—„â”€â”€â”€ MARKER!    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â–¼                                                  â”‚
â”‚  Step 4: Store Globally                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SYSTEM_MESSAGES = [25 content blocks]                         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PROCESSING EACH REQUEST                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Video Processing Pipeline:                                                 â”‚
â”‚                                                                              â”‚
â”‚  1. Video Frame                                                             â”‚
â”‚     â†“                                                                        â”‚
â”‚  2. Triton (YOLO Detection)                                                 â”‚
â”‚     â†“                                                                        â”‚
â”‚  3. BOTSORT (Tracking)                                                      â”‚
â”‚     â†“                                                                        â”‚
â”‚  4. Crop Person/Vehicle                                                     â”‚
â”‚     â†“                                                                        â”‚
â”‚  5. Encode Crop as Base64                                                   â”‚
â”‚     â†“                                                                        â”‚
â”‚  6. Build Bedrock Payload                                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Bedrock Nova Lite Payload                                    â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ {                                                             â”‚           â”‚
â”‚  â”‚   "system": SYSTEM_MESSAGES,  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚           â”‚
â”‚  â”‚                                                   â”‚           â”‚           â”‚
â”‚  â”‚   "messages": [                                   â”‚           â”‚           â”‚
â”‚  â”‚     {                                             â”‚           â”‚           â”‚
â”‚  â”‚       "role": "user",                             â”‚           â”‚           â”‚
â”‚  â”‚       "content": [                                â”‚           â”‚           â”‚
â”‚  â”‚         {                                         â”‚           â”‚           â”‚
â”‚  â”‚           "image": {                              â”‚           â”‚           â”‚
â”‚  â”‚             "format": "jpeg",                     â”‚           â”‚           â”‚
â”‚  â”‚             "source": {"bytes": crop_base64}  â—„â”€â”€â”¼â”€â”€ NEW    â”‚           â”‚
â”‚  â”‚           }                                       â”‚           â”‚           â”‚
â”‚  â”‚         },                                        â”‚           â”‚           â”‚
â”‚  â”‚         {                                         â”‚           â”‚           â”‚
â”‚  â”‚           "text": "Analyze this image..."        â”‚           â”‚           â”‚
â”‚  â”‚         }                                         â”‚           â”‚           â”‚
â”‚  â”‚       ]                                           â”‚           â”‚           â”‚
â”‚  â”‚     }                                             â”‚           â”‚           â”‚
â”‚  â”‚   ]                                               â”‚           â”‚           â”‚
â”‚  â”‚ }                                                 â”‚           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                       â”‚                       â”‚
â”‚                                                       â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Bedrock Caching Layer                             â”‚           â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â”‚  â”‚                                                                 â”‚          â”‚
â”‚  â”‚ First Request:                                                 â”‚          â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚          â”‚
â”‚  â”‚   â”‚ System Messages (25 blocks)     â”‚ â”€â”€â–º CACHE THIS         â”‚          â”‚
â”‚  â”‚   â”‚ with cachePoint marker          â”‚                         â”‚          â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚          â”‚
â”‚  â”‚                                                                 â”‚          â”‚
â”‚  â”‚ Subsequent Requests:                                           â”‚          â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚          â”‚
â”‚  â”‚   â”‚ System Messages detected        â”‚ â”€â”€â–º REUSE CACHED âš¡     â”‚          â”‚
â”‚  â”‚   â”‚ (same content hash)             â”‚                         â”‚          â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚          â”‚
â”‚  â”‚                                                                 â”‚          â”‚
â”‚  â”‚ Benefits:                                                       â”‚          â”‚
â”‚  â”‚   â€¢ Faster inference (cached context)                          â”‚          â”‚
â”‚  â”‚   â€¢ Lower costs (not charged for cached tokens)               â”‚          â”‚
â”‚  â”‚   â€¢ Consistent examples                                        â”‚          â”‚
â”‚  â”‚                                                                 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  7. Get Response from Bedrock                                               â”‚
â”‚     â†“                                                                        â”‚
â”‚  8. Parse JSON (PPE status, vehicle type)                                   â”‚
â”‚     â†“                                                                        â”‚
â”‚  9. Annotate Video Frame                                                    â”‚
â”‚     â†“                                                                        â”‚
â”‚  10. Generate Summary & Upload to S3                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COST COMPARISON                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WITHOUT Caching (Before):                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Request 1: [System + 12 images + crop1] â†’ Full cost          â”‚           â”‚
â”‚  â”‚ Request 2: [System + 12 images + crop2] â†’ Full cost          â”‚           â”‚
â”‚  â”‚ Request 3: [System + 12 images + crop3] â†’ Full cost          â”‚           â”‚
â”‚  â”‚ Request N: [System + 12 images + cropN] â†’ Full cost          â”‚           â”‚
â”‚  â”‚                                                               â”‚           â”‚
â”‚  â”‚ Total Cost = N Ã— (system + 12 images + crop)                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  WITH Caching (After):                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Request 1: [System + 12 images + crop1] â†’ Cache + small fee  â”‚           â”‚
â”‚  â”‚ Request 2: [crop2 only]                 â†’ Small fee âš¡        â”‚           â”‚
â”‚  â”‚ Request 3: [crop3 only]                 â†’ Small fee âš¡        â”‚           â”‚
â”‚  â”‚ Request N: [cropN only]                 â†’ Small fee âš¡        â”‚           â”‚
â”‚  â”‚                                                               â”‚           â”‚
â”‚  â”‚ Total Cost = (system + 12 images) + (N Ã— crop)               â”‚           â”‚
â”‚  â”‚                    â–²                                          â”‚           â”‚
â”‚  â”‚                    â””â”€â”€ Paid once, cached after                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  Savings: ~85-90% on repeated requests! ğŸ’°                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /upload-video
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI    â”‚
â”‚   (main.py)  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚    â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚
    â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   S3     â”‚          â”‚  Triton  â”‚
â”‚ (Upload) â”‚          â”‚  (YOLO)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚
     â”‚                     â–¼
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚  BOTSORT    â”‚
     â”‚              â”‚ (Tracking)  â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚
     â”‚                     â–¼
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚   Crop      â”‚
     â”‚              â”‚  Images     â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚
     â”‚                     â–¼
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚    Bedrock      â”‚
     â”‚              â”‚   Nova Lite     â”‚
     â”‚              â”‚  (w/ Caching)   â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚
     â”‚                     â–¼
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚  Annotate   â”‚
     â”‚              â”‚    Video    â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚
     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   S3 (Output)              â”‚
â”‚   - Annotated Video        â”‚
â”‚   - JSON Results           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Responsibilities

| Component | Responsibility |
|-----------|---------------|
| **FastAPI** | API endpoints, request routing, orchestration |
| **Triton** | YOLO object detection (persons, vehicles) |
| **BOTSORT** | Multi-object tracking across frames |
| **Bedrock Nova** | Vision analysis (PPE classification, vehicle type) |
| **S3** | Video storage (input/output), JSON results |
| **Sample Images** | Visual examples for Bedrock (cached) |
| **System Messages** | Instructions + samples (cached at startup) |

## File Structure

```
Manufacturing_Usecase/
â”œâ”€â”€ main.py                    # Main application (FastAPI + caching)
â”œâ”€â”€ requirements.txt           # Python dependencies
â”œâ”€â”€ .env                       # Environment variables (create this)
â”œâ”€â”€ .gitignore                 # Git ignore rules
â”‚
â”œâ”€â”€ samples/                   # Sample images directory
â”‚   â”œâ”€â”€ README.md              # Sample image requirements
â”‚   â”œâ”€â”€ hardhat/
â”‚   â”‚   â””â”€â”€ hardhat1.jpg       # (user provides)
â”‚   â”œâ”€â”€ goggles/
â”‚   â”‚   â””â”€â”€ goggles1.jpg       # (user provides)
â”‚   â”œâ”€â”€ vest/
â”‚   â”‚   â””â”€â”€ safety_vest1.jpg   # (user provides)
â”‚   â”œâ”€â”€ gloves/
â”‚   â”‚   â””â”€â”€ gloves1.jpg        # (user provides)
â”‚   â”œâ”€â”€ shoes/
â”‚   â”‚   â””â”€â”€ shoes1.jpg         # (user provides)
â”‚   â”œâ”€â”€ forklift/
â”‚   â”‚   â””â”€â”€ forklift1.jpg      # (user provides)
â”‚   â”œâ”€â”€ truck/
â”‚   â”‚   â””â”€â”€ truck1.jpg         # (user provides)
â”‚   â”œâ”€â”€ excavator/
â”‚   â”‚   â””â”€â”€ excavator1.jpg     # (user provides)
â”‚   â”œâ”€â”€ bull_dozer/
â”‚   â”‚   â””â”€â”€ bull_dozer1.jpg    # (user provides)
â”‚   â”œâ”€â”€ cement_mixer/
â”‚   â”‚   â””â”€â”€ cement_mixer1.jpg  # (user provides)
â”‚   â”œâ”€â”€ roller/
â”‚   â”‚   â””â”€â”€ roller1.jpg        # (user provides)
â”‚   â””â”€â”€ tracktor/
â”‚       â””â”€â”€ tracktor1.jpg      # (user provides)
â”‚
â”œâ”€â”€ README.md                  # Main documentation
â”œâ”€â”€ SETUP.md                   # Setup instructions
â”œâ”€â”€ QUICKSTART.md              # Quick start guide
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md  # Technical details
â”œâ”€â”€ ARCHITECTURE.md            # This file (architecture diagrams)
â””â”€â”€ test_caching_structure.py  # Verification tests
```
